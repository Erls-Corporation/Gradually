<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<title>Gradually</title>
		<meta name="keywords" content="mootools,demo,javascript,animation,canvas" />
		<meta name="description" content="" />
		<meta name="author" content="Noritaka Horio" />
		<meta name="copyright" content="2009 Noritaka Horio All rights reserved" />
		<link rel="stylesheet" type="text/css" href="../Demos/css/reset.css" media="screen,print" />
		<link rel="stylesheet" type="text/css" href="../Demos/css/gradually.css" media="screen,print" />
		<script type="text/javascript" src="../Demos/js/libraries/mootools-1.2.4-core.js"></script>
		<script type="text/javascript" src="../Demos/js/libraries/mootools-1.2.4.2-more.js"></script>
		<script type="text/javascript" src="js/libraries/canvas/CANVAS.js"></script>
		<script type="text/javascript" src="js/libraries/canvas/Layer.js"></script>
		<script type="text/javascript" src="js/libraries/canvas/LayerHash.js"></script>
		<script type="text/javascript" src="js/libraries/canvas/CanvasItem.js"></script>
		<script type="text/javascript">
			window.addEvent("domready", function() {

				var onDraw = function(ctx) {
					ctx.clearRect(props.x, props.y, props.width, props.height);
					ctx.drawImage(props.source,
						props.x, props.y, props.width, props.height,
						props.x, props.y, props.width, props.height);
		        }

				var onDrawMotion = function(ctx) {
					var fx = new Fx.Gradually({
						"transition": "back:out",
						"duration": 600,
						"link": "cancel",
						"fps": 30,
						"onMotion": this.onDrawMotion.bind(context),
						"onComplete": this.onDrawProgress.bind(this)
					});
	
					fx.start({
						"height": [50,0],
						"width": [50,0],
						"top": [top, top + 50/2],
						"left": [left,left + 50/2]}
					);
					duration = duration + 70;
				}

				var image = new Asset.image('images/demo1.jpg', {"id": "demo",
					'onload': function() {





//width: 650, height: 257

		var cols = 650 / 50; 
		var rows = 257 / 50;
		var total = cols * rows;

		for (var x = 0; x < cols; x++) {
			for (var y = 0; y < rows; y++) {
				var left = x * 50, top = y * 50;
				var context = {"ctx2d": ctx, "source": source, "x": left, "y": top, "width": 50, "height": 50}
			}
		}

						var props = {"source": image, x: 0, y: 0, width: 650, height: 257};

						var canvas = new Element("canvas", {"height": "257", "width": 650});
						canvas.inject($("canvasContainer"));
		
				        CANVAS.init({'canvasElement' : canvas});
						CANVAS.layers.add(new Layer({'id' : 'master'}));

		            	CANVAS.layers.get('master').add(new CanvasItem({id : 'item-1', 'events': {'onDraw': onDraw}}));
						CANVAS.draw();
		            //	CANVAS.layers.get('master').add(new CanvasItem({id : 'item-1'}));
					}		
				});


			});
		</script>
		<style type="text/css">
			canvas {
				border: 5px solid #cccccc;
			}
		</style>
	</head>
	<body>
		<div id="warpper">
			<h1>Canvas</h1>
			<div id="canvasContainer">
		    </div>
	    </div>
	</body>
</html> 